<body>
<meta charset="UTF-8"/>
<meta
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
        name="viewport"
/>
<meta content="ie=edge" http-equiv="X-UA-Compatible"/>
<link href="css/output.css" rel="stylesheet"/>

<script type="importmap">
  {
    "imports": {
      "preact": "https://esm.sh/preact@10.19.2",
      "preact/": "https://esm.sh/preact@10.19.2/",
      "htm/preact": "https://esm.sh/htm@3.1.1/preact?external=preact"
    }
  }


</script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<link
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
        rel="stylesheet"
/>

<div class="p-2 hidden invisible">
    <div class="accordion">
        <div class="accordion-item">
            <section class="m-auto w-100">
                <h3 class="accordion-header text-center" id="headingOne">
                    <button
                            aria-controls="collapse_myAddr"
                            aria-expanded="true"
                            class="accordion-button collapsed"
                            data-bs-target="#collapse_myAddr"
                            data-bs-toggle="collapse"
                            type="button"
                    >
                        myAddr
                    </button>
                </h3>
                <div
                        aria-labelledby="headingOne"
                        class="accordion-collapse collapse"
                        data-bs-parent="#accordionExample"
                        id="collapse_myAddr"
                >
                    <div class="accordion-body">
                        <form class="d-flex flex-column gap-2 p-2" id="form-myAddr">
                            <div>
                                <button
                                        class="btn btn-primary mt-2"
                                        data-form-name="myAddr"
                                        id="btn"
                                        type="button"
                                >
                                    Read
                                </button>
                            </div>
                            <div>
                                <p>Response:</p>
                                <div>
                                    :
                                    <span
                                            data-field-type="address"
                                            data-form-name="myAddr"
                                            id="form-output-myAddr-0"
                                    >address</span
                                    >
                                    <br/>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
<!-- ========== HEADER ========== -->
<header id="header" class="flex flex-wrap sm:justify-start sm:flex-nowrap z-50 w-full bg-white border-b border-gray-200 text-sm py-3 sm:py-0 dark:bg-neutral-800 dark:border-neutral-700">
    <nav aria-label="Global"
         class="relative flex flex-wrap basis-full items-center w-full mx-auto px-4 sm:flex sm:items-center sm:justify-between sm:px-6 lg:px-8">
        <div class="flex items-center justify-between">
            <a aria-label="Brand" class="flex-none text-xl font-semibold dark:text-white" href="#" id="minidao-name"></a>
        </div>


        <div class="flex items-center ms-auto sm:ms-0 sm:order-3">
            <div class="sm:hidden">
                <button aria-controls="navbar-offcanvas-example"
                        aria-label="Toggle navigation"
                        class="p-2 inline-flex justify-center items-center gap-2 rounded-lg border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-blue-600 transition-all text-xs dark:bg-neutral-800 dark:hover:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:hover:text-white dark:focus:ring-offset-gray-800"
                        data-hs-overlay="#navbar-offcanvas-example"
                        type="button">
                    Menu
                    <svg class="hs-overlay-open:hidden size-4" fill="none" height="24" stroke="currentColor"
                         stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"
                         xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="1"/>
                        <circle cx="12" cy="5" r="1"/>
                        <circle cx="12" cy="19" r="1"/>
                    </svg>
                </button>
            </div>
            <span class="ml-4">
                <button class="hs-dark-mode-active:hidden block hs-dark-mode rounded-full"
                        data-hs-theme-click-value="dark"
                        type="button">
                    <span class="group inline-flex flex-shrink-0 justify-center items-center size-9 font-medium rounded-full text-gray-800 hover:bg-gray-200 dark:text-neutral-200 dark:hover:bg-neutral-700">
                      <svg class="flex-shrink-0 size-4" fill="none" height="24" stroke="currentColor"
                           stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                           width="24"
                           xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                      </svg>
                    </span>
                </button>
                <button class="hs-dark-mode-active:block hidden hs-dark-mode rounded-full"
                        data-hs-theme-click-value="light"
                        type="button">
                    <span class="group inline-flex flex-shrink-0 justify-center items-center size-9 font-medium rounded-full text-gray-800 hover:bg-gray-200 dark:text-neutral-200 dark:hover:bg-neutral-700">
                      <svg class="flex-shrink-0 size-4" fill="none" height="24" stroke="currentColor"
                           stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                           width="24"
                           xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="4"></circle>
                        <path d="M12 2v2"></path>
                        <path d="M12 20v2"></path>
                        <path d="m4.93 4.93 1.41 1.41"></path>
                        <path d="m17.66 17.66 1.41 1.41"></path>
                        <path d="M2 12h2"></path>
                        <path d="M20 12h2"></path>
                        <path d="m6.34 17.66-1.41 1.41"></path>
                        <path d="m19.07 4.93-1.41 1.41"></path>
                      </svg>
                    </span>
                </button>
            </span>
        </div>

        <div class="hs-overlay hs-overlay-open:translate-x-0 -translate-x-full fixed top-0 start-0 transition-all duration-300 transform h-full max-w-xs w-full bg-white border-e basis-full grow sm:order-2 sm:static sm:block sm:h-auto sm:max-w-none sm:w-auto sm:border-r-transparent sm:transition-none sm:translate-x-0 sm:z-40 sm:basis-auto dark:bg-neutral-800 dark:border-r-gray-700 sm:dark:border-r-transparent hidden"
             data-hs-overlay-close-on-resize
             id="navbar-offcanvas-example" tabindex="-1">
            <ul class="flex flex-col gap-y-4 gap-x-0 mt-5 sm:flex-row sm:items-center sm:justify-end sm:gap-y-0 sm:gap-x-7 sm:mt-0 sm:ps-7">
                <li class="custom-link" data-page-id="post-page">Voting Feed</li>
                <li class="custom-link" data-page-id="templates-page">Templates</li>
                <li class="custom-link" data-page-id="create-proposal-page">Create Proposal</li>
                <li class="custom-link" data-page-id="donate-page">Donate</li>
            </ul>
        </div>
    </nav>
</header>
<!-- ========== END HEADER ========== -->

<!-- ========== MAIN CONTENT ========== -->
<main id="content">
    <div class="page mx-auto px-6 mt-6 flex flex-col gap-6" id="post-page">
        <div class="flex flex-col gap-4 sm:grid sm:grid-cols-12 sm:items-end">
            <button class="col-span-2 btn btn-df btn-outline-default h-12" data-hs-overlay="#feed-info-modal"
                    type="button">
                Info
            </button>
            <div class="hs-overlay hs-overlay-open:opacity-100 hs-overlay-open:duration-500 hidden size-full fixed top-0 start-0 z-80 opacity-0 overflow-x-hidden transition-all overflow-y-auto pointer-events-none"
                 id="feed-info-modal">
                <div class="sm:max-w-lg sm:w-full m-3 sm:mx-auto">
                    <div class="flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto dark:bg-neutral-800 dark:border-neutral-700 dark:shadow-neutral-700/70">
                        <div class="flex justify-between items-center py-3 px-4 border-b dark:border-neutral-700">
                            <h3 class="font-bold text-gray-800 dark:text-white">
                                Modal title
                            </h3>
                            <button class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-neutral-700"
                                    data-hs-overlay="#feed-info-modal"
                                    type="button">
                                <span class="sr-only">Close</span>
                                <svg class="flex-shrink-0 size-4" fill="none" height="24"
                                     stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                     stroke-width="2" viewBox="0 0 24 24"
                                     width="24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 6 6 18"></path>
                                    <path d="m6 6 12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="p-4 overflow-y-auto">
                            <p class="mt-1 text-gray-800 dark:text-neutral-400">
                                Here you can view statistics on votes for proposals and vote for, against or abstain.
                                Only the person who created the vote can cancel it.
                                Before voting, you should be sure to click on the delegate button to record the number
                                of tokens you now have for voting.
                                Any DAO member can queue and execute the proposal that wins the vote.
                            </p>
                        </div>
                        <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-neutral-700">
                            <button class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
                                    data-hs-overlay="#feed-info-modal"
                                    type="button">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="col-span-2 btn btn-df btn-outline-default h-12 relative" id="delegate-btn" type="button">
                Delegate
            </button>

            <script>
                const dgbtn = document.getElementById('delegate-btn')
                dgbtn.addEventListener('click', async () => {
                    try {
                        addFormLoader(dgbtn.id)
                        await token_contract.delegate(walletAddress)
                        toast('Success delegate!', 'success')
                    } catch (err) {
                        console.log(err)
                        toast('Error delegate!', 'error')
                    } finally {
                        removeFormLoader(dgbtn.id)
                    }
                })
            </script>
            <div class="col-span-4">
                <label class="label" for="status-filter">Status</label>
                <select class="py-3 px-4 pe-9 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
                        id="status-filter">
                </select>
            </div>
            <div class="col-span-4">
                <label class="label" for="filter">Filter</label>
                <select class="py-3 px-4 pe-9 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
                        id="filter">
                </select>
            </div>

            <script type="module">
                const status_filter = document.getElementById('status-filter')
                const filter = document.getElementById('filter')

                const statuses = [
                    'all',
                    'Pending',
                    'Active',
                    'Canceled',
                    'Defeated',
                    'Succeeded',
                    'Queued',
                    'Expired',
                    'Executed'
                ]

                const filters = [
                    'Newest',
                    'Oldest'
                ]

                statuses.forEach(status => {
                    status_filter.innerHTML += (`<option ${localStorage.getItem('sort_status') === status ? 'selected' : ''}>${status}</option>`)
                })

                filters.forEach(filter_item => {
                    filter.innerHTML += (`<option ${localStorage.getItem('sort_direction') === filter_item ? 'selected' : ''}>${filter_item}</option>`)
                })

                status_filter.addEventListener('change', e => {
                    console.log(e.target.value)
                    localStorage.setItem('sort_status', e.target.value)
                    getPosts().then(() => {
                        const event = new Event('postsUpdated');
                        document.dispatchEvent(event);
                    })
                })

                filter.addEventListener('change', e => {
                    console.log(e.target.value)
                    localStorage.setItem('sort_direction', e.target.value)
                    getPosts().then(() => {
                        const event = new Event('postsUpdated');
                        document.dispatchEvent(event);
                    })
                })
            </script>
        </div>

        <!--        Post Feed-->
        <div class="flex flex-col gap-6 mt-2 pb-24" id="post-feed">

        </div>
        <!--        End Post Feed-->
    </div>

    <div class="page flex flex-col items-center gap-10 pt-10 hidden" id="templates-page">
        <div class="flex p-1 bg-gray-100 rounded-lg dark:bg-neutral-800">
            <div class="relative flex flex-col sm:flex-row gap-x-1">
                <button class="tab relative z-10 px-3 py-2 text-xs font-medium transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500 tab-active"
                        data-tab-id="templates-issue-grant-form"
                        role="tab" type="button">
                    Issue grant
                </button>
                <button class="tab relative z-10 px-3 py-2 text-xs font-medium text-gray-800 transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500"
                        data-tab-id="templates-additional-mint-form"
                        role="tab" type="button">
                    Additional mint
                </button>
                <button class="tab relative z-10 px-3 py-2 text-xs font-medium text-gray-800 transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500"
                        data-tab-id="templates-pay-erc20-form"
                        role="tab" type="button">
                    Pay ERC20 grant
                </button>
                <button class="tab relative z-10 px-3 py-2 text-xs font-medium text-gray-800 transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500"
                        data-tab-id="templates-pay-nft721-form"
                        role="tab" type="button">
                    Pay NFT721 grant
                </button>
                <button class="tab relative z-10 px-3 py-2 text-xs font-medium text-gray-800 transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500"
                        data-tab-id="templates-simple-voting-form"
                        role="tab" type="button">
                    Simple voting
                </button>
            </div>
        </div>

        <div>
            <button class="btn btn-df btn-outline-default w-96 mb-4" data-hs-overlay="#templates-info-modal">Info about
                templates
            </button>
            <form class="template-card card gap-4 w-96" id="templates-issue-grant-form">
                <div>
                    <label class="label" for="issue-wallet-address">Receiver wallet address</label>
                    <input class="input" id="issue-wallet-address" name="wallet_address"
                           placeholder="Enter wallet address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="issue-amount">Amount</label>
                    <input class="input" id="issue-amount" name="amount" placeholder="Enter amount" type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="issue-description">Description</label>
                    <textarea class="input" id="issue-description" name="description" placeholder="Enter your text..."
                              rows="3"></textarea>
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Create proposal</button>

                <script type="module">
                    const form = document.getElementById('templates-issue-grant-form')
                    const wallet_address = form.querySelector('input[name=wallet_address]');
                    const amount = form.querySelector('input[name=amount]');
                    const description = form.querySelector('textarea[name=description]');

                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([amount, description]) && !checkWallet([wallet_address])) {
                            if (!contract) {
                                toast('Contract not connected!', 'error')
                            }

                            try {
                                addFormLoader(form.id)
                                console.log(wallet_address.value)
                                const calldata = (
                                    await treasury_contract.releaseNativeToken.populateTransaction(
                                        wallet_address.value,
                                        amount.value
                                    )
                                ).data;
                                await mini_contract.propose(
                                    [treasury_address],
                                    [0],
                                    [calldata],
                                    description.value
                                );
                                getPosts().then(() => {
                                    const event = new Event('postsUpdated');
                                    document.dispatchEvent(event);
                                })
                                toast('Success issue a grant!', 'success')
                                form.reset()
                            } catch (error) {
                                console.log(error)
                                toast('Error issue grant!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
            <form class="template-card hidden card gap-4 w-96" id="templates-additional-mint-form">
                <div>
                    <label class="label" for="additional-wallet-address">Receiver wallet address</label>
                    <input class="input" id="additional-wallet-address" name="wallet_address"
                           placeholder="Enter wallet address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="additional-amount">Amount</label>
                    <input class="input" id="additional-amount" name="amount" placeholder="Enter amount" type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="additional-description">Description</label>
                    <textarea class="input" id="additional-description" name="description"
                              placeholder="Enter your text..." rows="3"></textarea>
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Create proposal</button>

                <script type="module">
                    const form = document.getElementById('templates-additional-mint-form')
                    const wallet_address = form.querySelector('input[name=wallet_address]');
                    const amount = form.querySelector('input[name=amount]');
                    const description = form.querySelector('textarea[name=description]');

                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([amount, description]) && !checkWallet([wallet_address])) {
                            if (!contract) {
                                toast('Contract not connected!', 'error')
                            }

                            try {
                                addFormLoader(form.id)
                                const calldata = (
                                    await token_contract.mint.populateTransaction(wallet_address.value, amount.value)
                                ).data;
                                await mini_contract.propose(
                                    [token_address],
                                    [0],
                                    [calldata],
                                    description.value
                                );
                                getPosts().then(() => {
                                    const event = new Event('postsUpdated');
                                    document.dispatchEvent(event);
                                })
                                toast('Success additional mint!', 'success')
                                form.reset()
                            } catch (error) {
                                console.log(error)
                                toast('Error additional mint!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
            <form class="template-card hidden card gap-4 w-96" id="templates-pay-erc20-form">
                <div>
                    <label class="label" for="pay-erc20-wallet-address">Receiver wallet address</label>
                    <input class="input" id="pay-erc20-wallet-address" name="wallet_address"
                           placeholder="Enter wallet address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-erc20-amount">Amount</label>
                    <input class="input" id="pay-erc20-amount" name="amount" placeholder="Enter amount" type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-erc20-token-address">Token address</label>
                    <input class="input" id="pay-erc20-token-address" name="token_address"
                           placeholder="Enter token address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-erc20-description">Description</label>
                    <textarea class="input" id="pay-erc20-description" name="description"
                              placeholder="Enter your text..."
                              rows="3"></textarea>
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Create proposal</button>

                <script type="module">
                    const form = document.getElementById('templates-pay-erc20-form')
                    const wallet_address = form.querySelector('input[name=wallet_address]')
                    const amount = form.querySelector('input[name=amount]')
                    const token_address = form.querySelector('input[name=token_address]')
                    const description = form.querySelector('textarea[name=description]')

                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([wallet_address, amount, token_address, description]) && !checkWallet([wallet_address, token_address])) {
                            if (!contract) {
                                toast('Contract not connected!', 'error')
                            }

                            try {
                                addFormLoader(form.id)
                                const calldata = (
                                    await treasury_contract.releaseERC20Token.populateTransaction(wallet_address.value, amount.value, token_address.value)
                                ).data;
                                await mini_contract.propose(
                                    [treasury_address],
                                    [0],
                                    [calldata],
                                    description.value
                                );
                                getPosts().then(() => {
                                    const event = new Event('postsUpdated');
                                    document.dispatchEvent(event);
                                })
                                toast('Success pay ERC20!', 'success')
                                form.reset()
                            } catch (err) {
                                console.log(err)
                                toast('Error pay ERC20!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
            <form class="template-card hidden card gap-4 w-96" id="templates-pay-nft721-form">
                <div>
                    <label class="label" for="pay-erc20-wallet-address">Receiver wallet address</label>
                    <input class="input" id="pay-nft721-wallet-address" name="wallet_address"
                           placeholder="Enter wallet address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-nft721-id">ID</label>
                    <input class="input" id="pay-nft721-id" name="nft721-id" placeholder="Enter ID" type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-nft721-token-address">Token address</label>
                    <input class="input" id="pay-nft721-token-address" name="token_address"
                           placeholder="Enter token address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="pay-nft721-description">Description</label>
                    <textarea class="input" id="pay-nft721-description" name="description"
                              placeholder="Enter your text..."
                              rows="3"></textarea>
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Create proposal</button>

                <script type="module">
                    const form = document.getElementById('templates-pay-nft721-form')
                    const wallet_address = form.querySelector('input[name=wallet_address]')
                    const id = form.querySelector('input[name=nft721-id]')
                    const token_address = form.querySelector('input[name=token_address]')
                    const description = form.querySelector('textarea[name=description]')

                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([wallet_address, id, token_address, description]) && !checkWallet([wallet_address, token_address])) {
                            if (!contract) {
                                toast('Contract not connected!', 'error')
                            }

                            try {
                                addFormLoader(form.id)
                                const calldata = (
                                    await treasury_contract.releaseERC721Token.populateTransaction(wallet_address.value, id.value, token_address.value)
                                ).data;
                                await mini_contract.propose(
                                    [treasury_address],
                                    [0],
                                    [calldata],
                                    description.value
                                );
                                getPosts().then(() => {
                                    const event = new Event('postsUpdated');
                                    document.dispatchEvent(event);
                                })
                                toast('Success pay NFT721!', 'success')
                                form.reset()
                            } catch (err) {
                                console.log(err)
                                toast('Error pay NFT721!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
            <form class="template-card hidden card gap-4 w-96" id="templates-simple-voting-form">
                <div>
                    <label class="label" for="simple-voting-description">Description</label>
                    <textarea class="input" id="simple-voting-description" name="description"
                              placeholder="Enter your text..." rows="3"></textarea>
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Create proposal</button>

                <script type="module">
                    const form = document.getElementById('templates-simple-voting-form')
                    const description = form.querySelector('textarea[name=description]')

                    form.addEventListener("submit", async e => {
                        e.preventDefault()

                        const targets = ["0x0000000000000000000000000000000000000000"];
                        const values = [0];
                        const calldatas = ["0x00"];

                        if (!checkRequired([description])) {
                            if (!contract) {
                                toast('Contract not connected!', 'error')
                            }

                            try {
                                addFormLoader(form.id)
                                await mini_contract.propose(targets, values, calldatas, description.value);
                                getPosts().then(() => {
                                    const event = new Event('postsUpdated');
                                    document.dispatchEvent(event);
                                })
                                toast('Success create simple vote!', 'success')
                                form.reset()
                            } catch (err) {
                                console.log(err)
                                toast('Error create simple vote!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
        </div>

        <div class="hs-overlay hs-overlay-open:opacity-100 hs-overlay-open:duration-500 hidden size-full fixed top-0 start-0 z-80 opacity-0 overflow-x-hidden transition-all overflow-y-auto pointer-events-none"
             id="templates-info-modal">
            <div class="sm:max-w-lg sm:w-full m-3 sm:mx-auto">
                <div class="flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto dark:bg-neutral-800 dark:border-neutral-700 dark:shadow-neutral-700/70">
                    <div class="flex justify-between items-center py-3 px-4 border-b dark:border-neutral-700">
                        <h3 class="font-bold text-gray-800 dark:text-white">
                            Templates information
                        </h3>
                        <button class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-neutral-700"
                                data-hs-overlay="#templates-info-modal"
                                type="button">
                            <span class="sr-only">Close</span>
                            <svg class="flex-shrink-0 size-4" fill="none" height="24" stroke="currentColor"
                                 stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6 6 18"></path>
                                <path d="m6 6 12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4 overflow-y-auto">
                        <p class="mt-1 text-gray-800 dark:text-neutral-400">
                            Here you can choose 5 templates to vote on. Be
                            sure to add a description of the proposal!
                            <br/>1. Pay out the grant in native tokens of
                            the platform, DAO has a treasury from which the
                            specified number of tokens will be transferred
                            to the specified address. <br/>2. Additional
                            issue of DAO tokens to give tokens to new
                            participants. <br/>3. Pay the grant in ERC20
                            tokens, DAO has a treasury from which a
                            specified number of tokens will be transferred
                            to a specified address. <br/>4. Pay the grant
                            in ERC721 tokens, DAO has a treasury from which
                            the specified NFT will be transferred to the
                            specified address. <br/>5. Simple voting - a
                            vote that doesn't need to be executed, you just
                            write a proposal and it can be voted on.
                        </p>
                    </div>
                    <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-neutral-700">
                        <button class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
                                data-hs-overlay="#templates-info-modal"
                                type="button">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const templateTabs = document.querySelectorAll('.tab')
            const templateCard = document.querySelectorAll('.template-card')

            templateTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    templateTabs.forEach(new_tab => {
                        if (new_tab === tab) {
                            tab.classList.add('tab-active')
                        } else {
                            new_tab.classList.remove('tab-active')
                        }
                    })

                    const activeCardId = tab.getAttribute('data-tab-id')

                    templateCard.forEach(card => {
                        if (card.id === activeCardId) {
                            card.classList.remove('hidden')
                        } else {
                            card.classList.add('hidden')
                        }
                    })
                })
            })
        </script>
    </div>

    <div class="page flex flex-col items-center pt-12 hidden" id="create-proposal-page">
        <div class="hs-overlay hs-overlay-open:opacity-100 hs-overlay-open:duration-500 hidden size-full fixed top-0 start-0 z-80 opacity-0 overflow-x-hidden transition-all overflow-y-auto pointer-events-none"
             id="create-proposal-info-modal">
            <div class="sm:max-w-lg sm:w-full m-3 sm:mx-auto">
                <div class="flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto dark:bg-neutral-800 dark:border-neutral-700 dark:shadow-neutral-700/70">
                    <div class="flex justify-between items-center py-3 px-4 border-b dark:border-neutral-700">
                        <h3 class="font-bold text-gray-800 dark:text-white">
                            Create proposal information
                        </h3>
                        <button class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-neutral-700"
                                data-hs-overlay="#create-proposal-info-modal"
                                type="button">
                            <span class="sr-only">Close</span>
                            <svg class="flex-shrink-0 size-4" fill="none" height="24" stroke="currentColor"
                                 stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6 6 18"></path>
                                <path d="m6 6 12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4 overflow-y-auto">
                        <p class="mt-1 text-gray-800 dark:text-neutral-400">
                            The page is for people who have sufficient competencies to create their contract and create
                            a proposal in the form of a contract.
                        </p>
                    </div>
                    <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-neutral-700">
                        <button class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
                                data-hs-overlay="#create-proposal-info-modal"
                                type="button">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn btn-df btn-outline-default w-96 mb-4" data-hs-overlay="#create-proposal-info-modal">Info
            about create proposal
        </button>
        <form class="card flex flex-col gap-4 w-96" id="create-proposal-form">
            <div>
                <label class="label" for="proposal-targets">Targets</label>
                <textarea class="input" id="proposal-targets" name="targets" placeholder="Enter targets..."
                          rows="3"></textarea>
                <p class="text-sm text-red-600 mt-2 hidden"></p>
            </div>
            <div>
                <label class="label" for="proposal-values">Values</label>
                <textarea class="input" id="proposal-values" name="values" placeholder="Enter targets..."
                          rows="3"></textarea>
                <p class="text-sm text-red-600 mt-2 hidden"></p>
            </div>
            <div>
                <label class="label" for="proposal-call-datas">Call datas</label>
                <textarea class="input" id="proposal-call-datas" name="calldatas" placeholder="Enter targets..."
                          rows="3"></textarea>
                <p class="text-sm text-red-600 mt-2 hidden"></p>
            </div>
            <div>
                <label class="label" for="proposal-description">Description</label>
                <textarea class="input" id="proposal-description" name="description" placeholder="Enter targets..."
                          rows="3"></textarea>
                <p class="text-sm text-red-600 mt-2 hidden"></p>
            </div>
            <button class="btn btn-df btn-solid-primary">Create proposal</button>

            <script type="module">
                // TODO
                const form = document.getElementById('create-proposal-form')
                const targets = form.querySelector('textarea[name=targets]')
                const values = form.querySelector('textarea[name=values]')
                const calldatas = form.querySelector('textarea[name=calldatas]')
                const description = form.querySelector('textarea[name=description]')

                form.addEventListener('submit', async e => {
                    e.preventDefault()

                    const create_proposal_targets = targets.value
                        .split("\n")
                        .map((wallet) => wallet.trim())
                        .filter((wallet) => wallet.trim() !== "");
                    const create_proposal_values = values.value
                        .split("\n")
                        .map((wallet) => wallet.trim())
                        .filter((wallet) => wallet.trim() !== "");
                    const create_proposal_call_datas = calldatas.value
                        .split("\n")
                        .map((wallet) => wallet.trim())
                        .filter((wallet) => wallet.trim() !== "");
                    const create_proposal_description = description.value

                    if (!checkRequired([targets, values, calldatas, description])) {
                        for (const wallet of create_proposal_targets) {
                            if (!/^0x[a-fA-F0-9]{40}$/.test(wallet)) {
                                toast('Targets have invalid addresses!', 'info')
                                return
                            }
                        }

                        try {
                            addFormLoader(form.id)
                            await mini_contract.propose(
                                create_proposal_targets,
                                create_proposal_values,
                                create_proposal_call_datas,
                                create_proposal_description
                            );
                            toast("Success create!", 'success');
                            form.reset();
                            getPosts().then(() => {
                                const event = new Event('postsUpdated');
                                document.dispatchEvent(event)
                            })
                        } catch (error) {
                            console.log(error);
                            toast("Error create!", 'error');
                        } finally {
                            removeFormLoader(form.id)
                        }
                    }
                })
            </script>
        </form>
    </div>

    <div class="page flex flex-col items-center gap-10 pt-10 hidden" id="donate-page">
        <p class="text-center text-xl">
            To donate money to us you can simply send ERC20 tokens and native network tokens to the: <br> <span
                id="treasury-address"></span>
        </p>

        <div class="flex p-1 bg-gray-100 rounded-lg dark:bg-neutral-800">
            <div class="relative flex flex-col sm:flex-row gap-x-1">
                <button class="donate-tab relative z-10 px-3 py-2 text-xs font-medium transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500 tab-active"
                        data-tab-id="donate-native-form"
                        role="tab" type="button">
                    Native
                </button>
                <button class="donate-tab relative z-10 px-3 py-2 text-xs font-medium text-gray-800 transition duration-200 border border-transparent rounded-md md:text-sm hover:border-gray-400 dark:text-neutral-200 dark:hover:text-white dark:hover:border-neutral-500"
                        data-tab-id="donate-erc20-form"
                        role="tab" type="button">
                    ERC20
                </button>
            </div>
        </div>

        <div>
            <form class="donate-card card gap-4 w-96" id="donate-native-form">
                <div>
                    <label class="label" for="donate-amount">Amount</label>
                    <input class="input" id="donate-amount" name="amount" placeholder="Enter amount in wei"
                           type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Send</button>

                <script type="module">
                    const form = document.getElementById('donate-native-form')
                    const amount = form.querySelector('input[name=amount]')
                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([amount])) {
                            try {
                                await signer.sendTransaction({
                                    to: treasury_address,
                                    value: amount.value,
                                });
                                addFormLoader(form.id)
                                toast('Success donate native token!', 'success')
                                form.reset()
                            } catch (err) {
                                console.log(err)
                                toast('Error donate native token!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
            <form class="donate-card hidden card gap-4 w-96" id="donate-erc20-form">
                <div>
                    <label class="label" for="donate-erc20-amount">Amount</label>
                    <input class="input" id="donate-erc20-amount" name="amount" placeholder="Enter amount"
                           type="number">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
                <div>
                    <label class="label" for="donate-erc-20-token-address">Token address</label>
                    <input class="input" id="donate-erc-20-token-address" name="token_address"
                           placeholder="Enter token address" type="text">
                    <p class="text-sm text-red-600 mt-2 hidden"></p>
                </div>

                <button class="btn btn-df btn-solid-primary">Send</button>

                <script type="module">
                    const form = document.getElementById('donate-erc20-form')
                    const amount = form.querySelector('input[name=amount]')
                    const token_address = form.querySelector('input[name=token_address]')
                    form.addEventListener('submit', async e => {
                        e.preventDefault()

                        if (!checkRequired([amount, token_address])) {
                            if (!/^0x[a-fA-F0-9]{40}$/.test(token_address.value)) {
                                toast("Wrong token address!", 'error');
                            }

                            try {
                                const erc20Contract = new ethers.Contract(
                                    token_address.value,
                                    tokenabi,
                                    signer
                                );
                                const decimals = await token_contract.decimals();
                                await erc20Contract.transfer(
                                    treasury_address,
                                    BigInt(amount.value) * 10n ** decimals
                                );
                                addFormLoader(form.id)
                                toast('Success donate erc20 token!', 'success')
                                form.reset()
                            } catch (err) {
                                console.log(err)
                                toast('Error donate erc20 token!', 'error')
                            } finally {
                                removeFormLoader(form.id)
                            }
                        }
                    })
                </script>
            </form>
        </div>

        <script>
            const donateTabs = document.querySelectorAll('.donate-tab')
            const donateCard = document.querySelectorAll('.donate-card')

            donateTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    donateTabs.forEach(new_tab => {
                        if (new_tab === tab) {
                            tab.classList.add('tab-active')
                        } else {
                            new_tab.classList.remove('tab-active')
                        }
                    })

                    const activeCardId = tab.getAttribute('data-tab-id')

                    donateCard.forEach(card => {
                        if (card.id === activeCardId) {
                            card.classList.remove('hidden')
                        } else {
                            card.classList.add('hidden')
                        }
                    })
                })
            })
        </script>
    </div>
</main>

<!--page router-->
<script>
    const pages = document.querySelectorAll('.page')
    const links = document.querySelectorAll('.custom-link')

    links.forEach(link => {
        link.addEventListener('click', () => {
            const pageId = link.getAttribute('data-page-id');
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('hidden')
                } else {
                    page.classList.add('hidden')
                }
            })
        })
    })
</script>

<!--preact script-->
<!-- ========== END MAIN CONTENT ========== -->

<!--post content modal-->
<div class="hs-overlay hidden size-full fixed top-0 start-0 z-80 overflow-x-hidden overflow-y-auto pointer-events-none"
     id="post-modal">
    <div id="post-modal-inner" class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 mt-0 opacity-0 ease-out transition-all sm:max-w-lg sm:w-full m-3 sm:mx-auto flex items-center">
        <div class="w-full max-h-full overflow-hidden flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto dark:bg-neutral-800 dark:border-neutral-700 dark:shadow-neutral-700/70">
            <div class="flex justify-between items-center py-3 px-4 border-b dark:border-neutral-700">
                <h3 class="font-bold text-gray-800 dark:text-white" id="post-modal-proposer">

                </h3>
                <button class="flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-neutral-700"
                        data-hs-overlay="#post-modal"
                        type="button">
                    <span class="sr-only">Close</span>
                    <svg class="flex-shrink-0 size-4" fill="none" height="24" stroke="currentColor"
                         stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6 6 18"></path>
                        <path d="m6 6 12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-4 overflow-y-auto">
                <div id="post-modal-text">

                </div>
            </div>
            <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-neutral-700">
                <button class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
                        data-hs-overlay="#post-modal"
                        type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://cdn.jsdelivr.net/npm/preline@2.1.0/dist/preline.min.js"></script>
<!--    utils-->
<script>
    const getStatusNameById = (status_id) => {
        const statusMap = {
            0: 'Pending',
            1: 'Active',
            2: 'Canceled',
            3: 'Defeated',
            4: 'Succeeded',
            5: 'Queued',
            6: 'Expired',
            7: 'Executed'
        };

        return statusMap[status_id] || 'Unknown Status';
    };

    function getToastIcon(status) {
        switch (status) {
            case 'info':
                return `<svg class="flex-shrink-0 size-4 text-blue-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg>`
            case 'success':
                return `<svg class="flex-shrink-0 size-4 text-teal-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"></path></svg>`
            case 'warning':
                return `<svg class="flex-shrink-0 size-4 text-yellow-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"></path></svg>`
            case 'error':
                return `<svg class="flex-shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path></svg>`
        }
    }

    function toast(message, status, timeout) {
        Toastify({
            text: message,
            duration: timeout? timeout : 5000
        }).showToast();
    }

    function showError(input, message) {
        input.classList.add('input-invalid');
        const text = input.parentElement.querySelector('p');
        text.classList.remove('hidden')
        text.innerText = message;
    }

    function showSuccess(input) {
        input.classList.remove('input-invalid')
        input.parentElement.querySelector('p').classList.add('hidden')
    }

    function checkWallet(inputArr) {
        let is_error = false;
        inputArr.forEach(function (input) {
            if (input.value.trim() === '') {
                showError(input, `${getFieldName(input)} is required`);
                is_error = true;
            } else {
                const walletAddressRegex = /^0x[a-fA-F0-9]{40}$/; // Пример для Ethereum-адреса
                if (!walletAddressRegex.test(input.value.trim())) {
                    showError(input, 'Invalid wallet address. Please enter a valid Ethereum address.');
                    is_error = true;
                } else {
                    showSuccess(input);
                }
            }
        });

        return is_error;
    }

    function checkRequired(inputArr) {
        let is_error = false;
        inputArr.forEach(function (input) {
            if (input.value.trim() === '') {
                showError(input, `${getFieldName(input)} is required`)
                is_error = true
            } else {
                showSuccess(input);
            }
        });

        return is_error;
    }

    function getFieldName(input) {
        return input.name.charAt(0).toUpperCase() + input.name.slice(1);
    }

    function addFormLoader(form_id) {
        const loader_html = `
    <div id="${form_id + '-loader'}" class="load-form">
        <span class="loader"></span>
    </div>`;

        const form = document.getElementById(form_id);
        if (form) {
            form.insertAdjacentHTML('beforeend', loader_html);
        }
    }

    function removeFormLoader(form_id) {
        const formLoader = document.getElementById(`${form_id}-loader`);
        if (formLoader) {
            formLoader.remove();
        }
    }

    function shortenAddress(address) {
        if (address.length < 10) return address; // Если адрес слишком короткий, возвращаем его как есть
        return address.slice(0, 6) + "..." + address.slice(-5); // Возвращаем сокращенный адрес
    }

    const html = document.querySelector('html')
    const isLightOrAuto =
        localStorage.getItem('hs_theme') === 'light' ||
        (localStorage.getItem('hs_theme') === 'auto' &&
            !window.matchMedia('(prefers-color-scheme: dark)').matches)
    const isDarkOrAuto =
        localStorage.getItem('hs_theme') === 'dark' ||
        (localStorage.getItem('hs_theme') === 'auto' &&
            window.matchMedia('(prefers-color-scheme: dark)').matches)
    if (isLightOrAuto && html.classList.contains('dark'))
        html.classList.remove('dark')
    else if (isDarkOrAuto && html.classList.contains('light'))
        html.classList.remove('light')
    else if (isDarkOrAuto && !html.classList.contains('dark'))
        html.classList.add('dark')
    else if (isLightOrAuto && !html.classList.contains('light'))
        html.classList.add('light')
</script>

<!--ethers js initializing-->
<script crossorigin="anonymous"
        integrity="sha512-e73T2EWkw8PZVlmYJl77YTCHY20/Z7oPCPOeKZGCulv9SEnLZEV3KLh27SJ9r0Q1HCPB/uVwnerv4b/Hkle6EA=="
        referrerpolicy="no-referrer"
        src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.12.1/ethers.umd.min.js"></script>
<script>
    // only for local
    const privateKey = '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80'
</script>
<script type="text/javascript">
    const abi = [
        "constructor(uint256 _minDelay, string _nameToken, string _symbolToken, string _nameDAO, uint48 _votingDelay, uint32 _votingPeriod, uint256 _quorumValue) payable",
        "function governor() view returns (address)",
        "function myAddr() view returns (address)",
        "function timeLock() view returns (address)",
        "function token() view returns (address)",
        "function treasury() view returns (address)"
    ];
    const miniabi = [
        "constructor(address _token, address _timelock, string _name, uint48 _votingDelay, uint32 _votingPeriod, uint256 _quorumValue)",
        "error CheckpointUnorderedInsertion()",
        "error FailedInnerCall()",
        "error GovernorAlreadyCastVote(address voter)",
        "error GovernorAlreadyQueuedProposal(uint256 proposalId)",
        "error GovernorDisabledDeposit()",
        "error GovernorInsufficientProposerVotes(address proposer, uint256 votes, uint256 threshold)",
        "error GovernorInvalidProposalLength(uint256 targets, uint256 calldatas, uint256 values)",
        "error GovernorInvalidQuorumFraction(uint256 quorumNumerator, uint256 quorumDenominator)",
        "error GovernorInvalidSignature(address voter)",
        "error GovernorInvalidVoteType()",
        "error GovernorInvalidVotingPeriod(uint256 votingPeriod)",
        "error GovernorNonexistentProposal(uint256 proposalId)",
        "error GovernorNotQueuedProposal(uint256 proposalId)",
        "error GovernorOnlyExecutor(address account)",
        "error GovernorOnlyProposer(address account)",
        "error GovernorQueueNotImplemented()",
        "error GovernorRestrictedProposer(address proposer)",
        "error GovernorUnexpectedProposalState(uint256 proposalId, uint8 current, bytes32 expectedStates)",
        "error InvalidAccountNonce(address account, uint256 currentNonce)",
        "error InvalidShortString()",
        "error QueueEmpty()",
        "error QueueFull()",
        "error SafeCastOverflowedUintDowncast(uint8 bits, uint256 value)",
        "error StringTooLong(string str)",
        "event EIP712DomainChanged()",
        "event ProposalCanceled(uint256 proposalId)",
        "event ProposalCreated(uint256 proposalId, address proposer, address[] targets, uint256[] values, string[] signatures, bytes[] calldatas, uint256 voteStart, uint256 voteEnd, string description)",
        "event ProposalExecuted(uint256 proposalId)",
        "event ProposalQueued(uint256 proposalId, uint256 etaSeconds)",
        "event ProposalThresholdSet(uint256 oldProposalThreshold, uint256 newProposalThreshold)",
        "event QuorumNumeratorUpdated(uint256 oldQuorumNumerator, uint256 newQuorumNumerator)",
        "event TimelockChange(address oldTimelock, address newTimelock)",
        "event VoteCast(address indexed voter, uint256 proposalId, uint8 support, uint256 weight, string reason)",
        "event VoteCastWithParams(address indexed voter, uint256 proposalId, uint8 support, uint256 weight, string reason, bytes params)",
        "event VotingDelaySet(uint256 oldVotingDelay, uint256 newVotingDelay)",
        "event VotingPeriodSet(uint256 oldVotingPeriod, uint256 newVotingPeriod)",
        "function BALLOT_TYPEHASH() view returns (bytes32)",
        "function CLOCK_MODE() view returns (string)",
        "function COUNTING_MODE() pure returns (string)",
        "function EXTENDED_BALLOT_TYPEHASH() view returns (bytes32)",
        "function cancel(address[] targets, uint256[] values, bytes[] calldatas, bytes32 descriptionHash) returns (uint256)",
        "function castVote(uint256 proposalId, uint8 support) returns (uint256)",
        "function castVoteBySig(uint256 proposalId, uint8 support, address voter, bytes signature) returns (uint256)",
        "function castVoteWithReason(uint256 proposalId, uint8 support, string reason) returns (uint256)",
        "function castVoteWithReasonAndParams(uint256 proposalId, uint8 support, string reason, bytes params) returns (uint256)",
        "function castVoteWithReasonAndParamsBySig(uint256 proposalId, uint8 support, address voter, string reason, bytes params, bytes signature) returns (uint256)",
        "function clock() view returns (uint48)",
        "function eip712Domain() view returns (bytes1 fields, string name, string version, uint256 chainId, address verifyingContract, bytes32 salt, uint256[] extensions)",
        "function execute(address[] targets, uint256[] values, bytes[] calldatas, bytes32 descriptionHash) payable returns (uint256)",
        "function getVotes(address account, uint256 timepoint) view returns (uint256)",
        "function getVotesWithParams(address account, uint256 timepoint, bytes params) view returns (uint256)",
        "function hasVoted(uint256 proposalId, address account) view returns (bool)",
        "function hashProposal(address[] targets, uint256[] values, bytes[] calldatas, bytes32 descriptionHash) pure returns (uint256)",
        "function name() view returns (string)",
        "function nonces(address owner) view returns (uint256)",
        "function onERC1155BatchReceived(address, address, uint256[], uint256[], bytes) returns (bytes4)",
        "function onERC1155Received(address, address, uint256, uint256, bytes) returns (bytes4)",
        "function onERC721Received(address, address, uint256, bytes) returns (bytes4)",
        "function proposalDeadline(uint256 proposalId) view returns (uint256)",
        "function proposalEta(uint256 proposalId) view returns (uint256)",
        "function proposalNeedsQueuing(uint256 proposalId) view returns (bool)",
        "function proposalProposer(uint256 proposalId) view returns (address)",
        "function proposalSnapshot(uint256 proposalId) view returns (uint256)",
        "function proposalThreshold() view returns (uint256)",
        "function proposalVotes(uint256 proposalId) view returns (uint256 againstVotes, uint256 forVotes, uint256 abstainVotes)",
        "function propose(address[] targets, uint256[] values, bytes[] calldatas, string description) returns (uint256)",
        "function queue(address[] targets, uint256[] values, bytes[] calldatas, bytes32 descriptionHash) returns (uint256)",
        "function quorum(uint256 blockNumber) view returns (uint256)",
        "function quorumDenominator() view returns (uint256)",
        "function quorumNumerator(uint256 timepoint) view returns (uint256)",
        "function quorumNumerator() view returns (uint256)",
        "function relay(address target, uint256 value, bytes data) payable",
        "function setProposalThreshold(uint256 newProposalThreshold)",
        "function setVotingDelay(uint48 newVotingDelay)",
        "function setVotingPeriod(uint32 newVotingPeriod)",
        "function state(uint256 proposalId) view returns (uint8)",
        "function supportsInterface(bytes4 interfaceId) view returns (bool)",
        "function timelock() view returns (address)",
        "function token() view returns (address)",
        "function updateQuorumNumerator(uint256 newQuorumNumerator)",
        "function updateTimelock(address newTimelock)",
        "function version() view returns (string)",
        "function votingDelay() view returns (uint256)",
        "function votingPeriod() view returns (uint256)"
    ];
    const tokenabi = [
        "constructor(address _timelock, string _name, string _symbol)",
        "error CheckpointUnorderedInsertion()",
        "error ECDSAInvalidSignature()",
        "error ECDSAInvalidSignatureLength(uint256 length)",
        "error ECDSAInvalidSignatureS(bytes32 s)",
        "error ERC20ExceededSafeSupply(uint256 increasedSupply, uint256 cap)",
        "error ERC20InsufficientAllowance(address spender, uint256 allowance, uint256 needed)",
        "error ERC20InsufficientBalance(address sender, uint256 balance, uint256 needed)",
        "error ERC20InvalidApprover(address approver)",
        "error ERC20InvalidReceiver(address receiver)",
        "error ERC20InvalidSender(address sender)",
        "error ERC20InvalidSpender(address spender)",
        "error ERC2612ExpiredSignature(uint256 deadline)",
        "error ERC2612InvalidSigner(address signer, address owner)",
        "error ERC5805FutureLookup(uint256 timepoint, uint48 clock)",
        "error ERC6372InconsistentClock()",
        "error InvalidAccountNonce(address account, uint256 currentNonce)",
        "error InvalidShortString()",
        "error SafeCastOverflowedUintDowncast(uint8 bits, uint256 value)",
        "error StringTooLong(string str)",
        "error VotesExpiredSignature(uint256 expiry)",
        "event Approval(address indexed owner, address indexed spender, uint256 value)",
        "event DelegateChanged(address indexed delegator, address indexed fromDelegate, address indexed toDelegate)",
        "event DelegateVotesChanged(address indexed delegate, uint256 previousVotes, uint256 newVotes)",
        "event EIP712DomainChanged()",
        "event Transfer(address indexed from, address indexed to, uint256 value)",
        "function CLOCK_MODE() view returns (string)",
        "function DOMAIN_SEPARATOR() view returns (bytes32)",
        "function allowance(address owner, address spender) view returns (uint256)",
        "function approve(address spender, uint256 value) returns (bool)",
        "function balanceOf(address account) view returns (uint256)",
        "function checkpoints(address account, uint32 pos) view returns (tuple(uint48 _key, uint208 _value))",
        "function clock() view returns (uint48)",
        "function decimals() view returns (uint8)",
        "function delegate(address delegatee)",
        "function delegateBySig(address delegatee, uint256 nonce, uint256 expiry, uint8 v, bytes32 r, bytes32 s)",
        "function delegates(address account) view returns (address)",
        "function eip712Domain() view returns (bytes1 fields, string name, string version, uint256 chainId, address verifyingContract, bytes32 salt, uint256[] extensions)",
        "function getPastTotalSupply(uint256 timepoint) view returns (uint256)",
        "function getPastVotes(address account, uint256 timepoint) view returns (uint256)",
        "function getVotes(address account) view returns (uint256)",
        "function mint(address to, uint256 amount)",
        "function mintBatch(address[] to, uint256[] amount)",
        "function name() view returns (string)",
        "function nonces(address _owner) view returns (uint256)",
        "function numCheckpoints(address account) view returns (uint32)",
        "function owner() view returns (address)",
        "function permit(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s)",
        "function symbol() view returns (string)",
        "function tokenDistribution(address[] to, uint256[] amount)",
        "function totalSupply() view returns (uint256)",
        "function transfer(address to, uint256 value) returns (bool)",
        "function transferFrom(address from, address to, uint256 value) returns (bool)"
    ];
    const treasuryabi = [
        "constructor(address _timelock) payable",
        "function onERC721Received(address, address, uint256, bytes) returns (bytes4)",
        "function owner() view returns (address)",
        "function releaseERC20Token(address to, uint256 amount, address token)",
        "function releaseERC721Token(address to, uint256 id, address token)",
        "function releaseNativeToken(address to, uint256 amount)"
    ];

    let contract_address, mini_address, token_address, treasury_address
    let provider, signer, walletAddress
    let contract, mini_contract, token_contract, treasury_contract

    const getContractAddress = () => {
        const button = document.getElementById('btn')
        if (button) {
            button.click()

            setTimeout(() => {
                contract_address = document.getElementById(
                    'form-output-myAddr-0'
                ).innerHTML
                console.log('contract address: ', contract_address)
            }, 500)
        }
    }

    const initApp = async () => {
        if (window.parent.ethereum == null) {
            console.log('MetaMask not installed; using read-only defaults')
            provider = ethers.getDefaultProvider()
        } else {
            provider = new ethers.BrowserProvider(window.parent.ethereum)

            signer = await provider.getSigner()
            contract = new ethers.Contract(contract_address, abi, signer)

            mini_address = await contract.governor()
            mini_contract = new ethers.Contract(
                mini_address,
                miniabi,
                signer
            )

            console.log()

            token_address = await contract.token()
            token_contract = new ethers.Contract(
                token_address,
                tokenabi,
                signer
            )

            treasury_address = await contract.treasury()
            treasury_contract = new ethers.Contract(
                treasury_address,
                treasuryabi,
                signer
            )

            document.getElementById('treasury-address').innerHTML =
                treasury_address
            console.log(treasury_address)

            walletAddress = signer.getAddress()
        }
    }

    setTimeout(() => {
        getContractAddress()
    }, 500)
    setTimeout(() => {
        initApp().then(async () => {
            document.getElementById('minidao-name').innerHTML = await mini_contract.name()
        })
    }, 2100)

    // const initApp = async () => {
    //     contract_address = '0x5FbDB2315678afecb367f032d93F642f64180aa3'
    //     provider = ethers.getDefaultProvider("http://127.0.0.1:8545/")
    //     signer = new ethers.Wallet(privateKey, provider)
    //     walletAddress = await signer.getAddress()
    //
    //     contract = new ethers.Contract(contract_address, abi, signer)
    //
    //     mini_address = await contract.governor()
    //     mini_contract = new ethers.Contract(mini_address, miniabi, signer)
    //
    //     token_address = await contract.token()
    //     token_contract = new ethers.Contract(token_address, tokenabi, signer)
    //
    //     treasury_address = await contract.treasury()
    //     treasury_contract = new ethers.Contract(treasury_address, treasuryabi, signer)
    //
    //     document.getElementById('treasury-address').innerHTML = treasury_address
    // }

    window.posts = []
    const getPosts = async () => {
        window.posts = []
        const data = await mini_contract.queryFilter("ProposalCreated")

        for (const [index, item] of data.entries()) {
            let formattedDate
            const block = await provider.getBlock(item.args.voteStart);
            if (block) {
                const date = new Date(block.timestamp * 1000);

                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();

                formattedDate = `${day < 10 ? "0" : ""}${day}.${
                    month < 10 ? "0" : ""
                }${month}.${year}`;
            }

            const status_id = await mini_contract.state(item.args.proposalId);

            const votes = await mini_contract.proposalVotes(item.args.proposalId);
            const decimals = await token_contract.decimals();
            const countUp = (votes[1] / 10n ** decimals).toString();
            const countNeutral = (votes[2] / 10n ** decimals).toString();
            const countDown = (votes[0] / 10n ** decimals).toString();

            const post = {
                index: index,
                proposer: item.args.proposer,
                vote_start: block ? formattedDate : item.args.voteStart,
                vote_end: item.args.voteEnd,
                description: item.args.description,
                status: getStatusNameById(status_id),
                status_id: status_id,
                votes: {
                    down: countDown,
                    up: countUp,
                    neutral: countNeutral,
                },
                extra: {
                    targets: Object.values(item.args.targets),
                    values: Object.values(item.args.values).length < 1
                        ? Array(Object.values(item.args.targets).length).fill(0)
                        : Object.values(item.args.values),
                    calldatas: Object.values(item.args.calldatas),
                    proposalId: item.args.proposalId
                }
            }

            window.posts.push(post);
        }
        if (localStorage.getItem('sort_direction') && localStorage.getItem('sort_direction') !== null && localStorage.getItem('sort_direction') !== "" && localStorage.getItem('sort_status') !== "" && localStorage.getItem('sort_status') !== null && localStorage.getItem('sort_status')) {
            sortPosts(localStorage.getItem('sort_status'), localStorage.getItem('sort_direction'))
        } else {
            sortPosts('all', 'Newest')
        }
    }

    function sortPosts(status, sort_direction) {
        console.log('sort')
        console.log(status, sort_direction)
        let filteredPosts = window.posts
        if (status !== 'all') {
            filteredPosts = filteredPosts.filter(post => post.status === status)
        }

        if (sort_direction === 'Newest') {
            filteredPosts = filteredPosts.sort((a, b) => b.index - a.index)
        }

        window.posts = filteredPosts;

        localStorage.setItem('sort_status', status);
        localStorage.setItem('sort_direction', sort_direction);
    }

    // initApp()

    const vote = async (proposalId, voteId) => {
        try {
            await mini_contract.castVote(proposalId, voteId);
            toast("Success voting!", 'success');
            getPosts().then(() => {
                const event = new Event('postsUpdated');
                document.dispatchEvent(event);
            })
        } catch (e) {
            console.log(e);
            toast("Error voting!", 'error');
        }
    };
</script>

<script type="module">
    import {render} from 'preact';
    import {useEffect, useState} from 'preact/hooks';
    import {html} from 'htm/preact';

    function Loader() {
        return html`
            <div className="w-full pt-10 flex flex-col items-center gap-4">
                <span class="loader"></span>
            </div>
        `
    }

    function renderBadge(status) {
        switch (status) {
            case 'Defeated':
                return html`
                    <span class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-white/10 dark:text-white">
                        ${status}
                    </span>
                `
            case 'ghost':
                return html`
                    <span class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-gray-50 text-gray-500 dark:bg-white/10 dark:text-white">
                        ${status}
                    </span>
                `
            case 'Executed':
            case 'Active':
            case 'Succeeded':
                return html`
                    <span class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-teal-100 text-teal-800 dark:bg-teal-800/30 dark:text-teal-500">
                        ${status}
                    </span>
                `
            case 'Pending':
                return html`
                    <span class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-500">${status}</span>
                `
            case 'Canceled':
            case 'Expired':
                return html`<span
                        class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-500">${status}</span>`
            case 'Queued':
                return html`<span
                        class="inline-flex items-center gap-x-1 py-1 px-2 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-500">${status}</span>`
        }
    }

    function Post({posts}) {
        const queuePost = async (targets, values, calldatas, description) => {
            const descriptionHash = ethers.keccak256(
                ethers.toUtf8Bytes(description)
            );
            try {
                await mini_contract.queue(
                    targets,
                    values,
                    calldatas,
                    descriptionHash
                );
                toast("Success queue post!", 'success');
                getPosts().then(() => {
                    const event = new Event('postsUpdated');
                    document.dispatchEvent(event);
                })
            } catch (e) {
                console.log(e);
                toast("Error queue post!", 'error');
            }
        };

        const executePost = async (targets, values, calldatas, description) => {
            const descriptionHash = ethers.keccak256(
                ethers.toUtf8Bytes(description)
            );
            try {
                await mini_contract.execute(
                    targets,
                    values,
                    calldatas,
                    descriptionHash
                );
                toast("Success execute post!", 'success');
                getPosts().then(() => {
                    const event = new Event('postsUpdated');
                    document.dispatchEvent(event);
                })
            } catch (e) {
                console.log(e);
                toast("Error execute post!", 'error');
            }
        };

        const cancelPost = async (targets, values, calldatas, description) => {
            const descriptionHash = ethers.keccak256(
                ethers.toUtf8Bytes(description)
            );
            try {
                await mini_contract.cancel(
                    targets,
                    values,
                    calldatas,
                    descriptionHash
                );
                toast("Success cancel post!", 'success');
                getPosts().then(() => {
                    const event = new Event('postsUpdated');
                    document.dispatchEvent(event);
                })
            } catch (e) {
                console.log(e);
                toast("Error cancel post!", 'error');
            }
        };

        if (!posts || posts.length < 1) {
            return 'No posts'
        }
        return posts.map((post, index) => (
            html`
                <div key="${index}" className="flex flex-col p-4 border-t-2 border-gray-200 dark:border-neutral-700">
                    <div className="flex w-full items-center justify-between">
                        <div>
                            <p className="text-neutral-800 dark:text-neutral-100 flex items-center gap-4">
                                ${shortenAddress(post.proposer)}
                                ${renderBadge(post.status, post.status)}
                            </p>
                            <p className="text-neutral-500 dark:text-gray-400">Start: ${post.vote_start} - End:
                                ${post.vote_end}</p>
                        </div>
                        <div className="hs-dropdown relative inline-flex">
                            <button
                                    className="hs-dropdown-toggle flex justify-center items-center size-9 text-sm font-semibold rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
                                    id="post-dropdown-${index}"
                                    type="button">
                                <svg className="flex-none size-4 text-gray-600 dark:text-neutral-500"
                                     fill="none" height="24" stroke="currentColor" strokeLinecap="round"
                                     strokeLinejoin="round" strokeWidth="2" viewBox="0 0 24 24" width="24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="12" cy="5" r="1"/>
                                    <circle cx="12" cy="19" r="1"/>
                                </svg>
                            </button>

                            <div aria-labelledby="post-dropdown-${index}"
                                 className="hs-dropdown-menu custom-dropdown-transition duration hs-dropdown-open:opacity-100 opacity-0 hidden min-w-60 bg-white shadow-md rounded-lg p-2 mt-2 dark:bg-neutral-800 dark:border dark:border-neutral-700">
                                <button
                                                    onClick=${() => cancelPost(post.extra.targets, post.extra.values, post.extra.calldatas, post.description)}
                                                    className="w-full flex items-center gap-x-3 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:hover:text-neutral-300 dark:focus:bg-neutral-700 disabled:opacity-50 disabled:pointer-events-none">
                                                Cancel
                                            </button>
                                <button
                                        onClick=${() => queuePost(post.extra.targets, post.extra.values, post.extra.calldatas, post.description)}
                                        className="w-full flex items-center gap-x-3 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:hover:text-neutral-300 dark:focus:bg-neutral-700 disabled:opacity-50 disabled:pointer-events-none">
                                    Queue
                                </button>
                                <button
                                        onClick=${() => executePost(post.extra.targets, post.extra.values, post.extra.calldatas, post.description)}
                                        className="w-full flex items-center gap-x-3 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:hover:text-neutral-300 dark:focus:bg-neutral-700 disabled:opacity-50 disabled:pointer-events-none">
                                    Execute
                                </button>
                            </div>
                        </div>
                    </div>
                    <p className="mt-3 line-clamp-6">
                        ${post.description}
                    </p>
                    <div className="flex items-center justify-between w-full mt-4">
                        <button
                                onClick=${() => {
                                    document.getElementById('post-modal-proposer').innerHTML = post.proposer
                                    document.getElementById('post-modal-text').innerHTML = post.description
                                }}
                                className="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-gray-200 text-gray-500 hover:border-blue-600 hover:text-blue-600 disabled:opacity-50 disabled:pointer-events-none dark:border-neutral-700 dark:text-neutral-400 dark:hover:text-blue-500 dark:hover:border-blue-600"
                                type="button" data-hs-overlay="#post-modal">
                            Read full
                        </button>

                        <div className="flex items-center gap-2">
                            <button
                                    onClick=${() => vote(post.extra.proposalId, 1)}
                                    className="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-teal-500 text-teal-500 hover:border-teal-400 hover:text-teal-400 disabled:opacity-50 disabled:pointer-events-none"
                                    type="button">
                                <p>⬆️</p>
                                <p>${post.votes.up}</p>
                            </button>
                            <button
                                    onClick=${() => vote(post.extra.proposalId, 2)}
                                    className="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-gray-500 text-gray-500 hover:border-gray-800 hover:text-gray-800 disabled:opacity-50 disabled:pointer-events-none dark:border-neutral-400 dark:text-neutral-400 dark:hover:text-neutral-300 dark:hover:border-neutral-300"
                                    type="button">
                                <p>❌</p>
                                <p>${post.votes.neutral}</p>
                            </button>
                            <button
                                    onClick=${() => vote(post.extra.proposalId, 0)}
                                    className="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-red-500 text-red-500 hover:border-red-400 hover:text-red-400 disabled:opacity-50 disabled:pointer-events-none"
                                    type="button">
                                <p>⬇️</p>
                                <p>${post.votes.down}</p>
                            </button>
                        </div>
                    </div>
                </div>
            `
        ));
    }

    function App() {
        const [posts, setPosts] = useState(window.posts)
        const [loading, setLoading] = useState(true)

        useEffect(() => {
            setTimeout(() => {
                getPosts().then(() => {
                    setLoading(false)
                    setPosts(window.posts)
                })
            }, 3000)
        }, [])

        useEffect(() => {
            window.HSStaticMethods.autoInit();
        }, posts)

        const handlePostsUpdated = () => {
            setPosts([...window.posts]);
        };

        useEffect(() => {
            document.addEventListener('postsUpdated', handlePostsUpdated);
            return () => {
                document.removeEventListener('postsUpdated', handlePostsUpdated);
            };
        }, []);

        if (loading) {
            return html`
                <${Loader}/>`
        }
        return html`
            <${Post} posts="${posts}" setPosts="${setPosts}"/>`
    }

    render(html`
        <${App}/>`, document.getElementById('post-feed'));
</script>
</body>
